{
  "info": {
    "name": "RechargeServices API",
    "_postman_id": "recharge-services-collection",
    "description": "Postman collection for RechargeServices. Use environment variable {{base_url}} (e.g., http://localhost:8080).",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "item": [
    {
      "name": "Auth - Login",
      "request": {
        "method": "POST",
        "header": [
          { "key": "Content-Type", "value": "application/x-www-form-urlencoded" }
        ],
        "body": {
          "mode": "urlencoded",
          "urlencoded": [
            { "key": "username", "value": "demoUser", "type": "text" },
            { "key": "password", "value": "demoPass", "type": "text" }
          ]
        },
        "url": {
          "raw": "{{base_url}}/api/auth/login",
          "host": ["{{base_url}}"],
          "path": ["api","auth","login"]
        }
      },
      "response": [],
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "// Save access token to environment variable 'access_token'",
              "try {",
              "  const body = pm.response.json();",
              "  if (body && body.access_token) {",
              "    pm.environment.set('access_token', body.access_token);",
              "  }",
              "  pm.test('Has access_token', () => pm.expect(body.access_token).to.be.a('string'));",
              "} catch (e) {",
              "  pm.test('Response is valid JSON', () => false);",
              "}"
            ],
            "type": "text/javascript"
          }
        }
      ]
    },
    {
      "name": "Recharge - Process (JSON)",
      "request": {
        "method": "POST",
        "header": [
          { "key": "Content-Type", "value": "application/json" },
          { "key": "Authorization", "value": "Bearer {{access_token}}" }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"payerUserId\": \"USER123\",\n  \"payeeUserId\": \"USER456\",\n  \"amount\": 100\n}",
          "options": { "raw": { "language": "json" } }
        },
        "url": {
          "raw": "{{base_url}}/api/recharge/process",
          "host": ["{{base_url}}"],
          "path": ["api","recharge","process"]
        }
      },
      "response": [],
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test('Status is 200', () => pm.response.to.have.status(200));",
              "let body = {};",
              "try { body = pm.response.json(); } catch (e) { body = null; }",
              "pm.test('Response has transferId when successful', () => {",
              "  if (body && body.transferId) {",
              "    pm.environment.set('last_txn_id', body.transferId);",
              "    pm.expect(body.transferId).to.be.a('string');",
              "  } else {",
              "    // If not JSON or missing transferId, still allow for error messages in plain text",
              "    pm.expect(pm.response.text().length).to.be.above(0);",
              "  }",
              "});"
            ],
            "type": "text/javascript"
          }
        }
      ]
    }
  ]
}
